#{extends 'main.html' /}
#{set title:'Merchants' /}
#{set overhidden:true /}

<a href="" class="button topright">Add New Merchant</a>
<div id="sidebar">
<form action="/search" method="get" id="search">
			<input type="text" name="q" class="search-box" value=""/>
			<input type="image" src="@{'/public/images/search.png'}" class="search-input" value="Search"/>
		</form>
	<ul>
	#{list items:allMerchants, as: 'merchant'}
		<li><a href="#" class="merchantlink" rel="${merchant.id}">${merchant.name}</a></li>
	#{/list}
	</ul>
</div>
#{list items:allMerchants, as: 'merchant'}
	<div class="merchant" id="${merchant.id}">
	<hgroup>
		<h2>${merchant.name}</h2>
		<a href="edit_merchant" class="button">Edit</a>
	</hgroup>
	<p>
	${merchant.address}</p>
	<p>
	${merchant.phonenumber}</p>
	<h3>Booking History</h3>
	<table>
		<thead>
			<tr>
				<th scope="col">Date</th>
				<th scope="col" class="thin">Stall</th>
				<th scope="col">Type</th>
				<th scope="col">Cost</th>
			</tr>
		</thead>
		<tbody>
		#{list items:currentBookingList, as:'booking'}
			#{if booking.merchantid == merchant.id }
				<tr>
					<td>${booking.startdate.format('MMMMM dd, yyyy')} - ${booking.enddate.format('MMMMM dd, yyyy')}</td>
					<td>${booking.stallnumber}</td>
					<td>${allCategories.get(allStalls.get(booking.stallnumber).categoryid).name}</td>
					<td>$${booking.price}</td>
				</tr>
			#{/if}
		#{/list}
		</tbody>
	</table>
	</div>
#{/list}